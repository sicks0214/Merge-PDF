# 📘《工具页面部署技术文档（插件模式）v1.0》

适用范围：

* 导航页已上线
* 插件系统已集成
* 分类页 `/pdf-tools` 与 `/image-tools` 已预设
* 你现在只需将 **工具页面（插件）** 正确部署到系统中

---

# 1. 插件系统结构（工具页面依赖点）

你的工具页面并不是一个独立前端，而是由导航页动态渲染。

导航页会读取：

```
/plugins/{tool}/plugin.json
/plugins/{tool}/ui.json
/plugins/{tool}/schema.json
/plugins/{tool}/handler.js
```

并自动生成：

* 工具列表展示
* 工具页面 UI（上传区、按钮、FAQ、SEO）
* 工具 API 路由

所以 "部署工具页面" = "部署插件文件"。

---

# 2. 插件目录结构（严格要求）

每一个工具必须使用下面的目录结构：

```
/plugins/
   └── merge-pdf/
         ├── plugin.json
         ├── ui.json
         ├── schema.json
         └── handler.js
```

所有文件必须全小写、路径必须正确，否则前端无法渲染。

---

# 3. 四个核心文件规范（必填）

## 3.1 plugin.json

用于让导航页识别工具属于哪个分类、用什么 slug 打开。

格式：

```json
{
  "slug": "merge-pdf",
  "category": "pdf",
  "name": "Merge PDF",
  "order": 1,
  "apiPath": "/api/pdf/merge-pdf"
}
```

字段含义：

| 字段       | 说明                           |
| -------- | ---------------------------- |
| slug     | 工具 URL： /pdf-tools/merge-pdf |
| category | 工具类别： pdf / image            |
| order    | 分类页排序                        |
| apiPath  | 后端调用 handler.js 的路径          |

---

## 3.2 ui.json

包含 SEO、UI 文案、FAQ、标题等。

```json
{
  "title": {
    "en": "Merge PDF",
    "zh": "合并 PDF"
  },
  "description": {
    "en": "Merge multiple PDFs into one file.",
    "zh": "将多个 PDF 合并成一个文件。"
  },
  "faq": {
    "en": [
      { "q": "How to merge PDF?", "a": "Upload and click Merge." }
    ],
    "zh": [
      { "q": "如何合并 PDF？", "a": "上传文件后点击合并按钮。" }
    ]
  }
}
```

### 导航页将自动生成：

* `<title>`
* `<meta description>`
* H1 标题
* FAQ 展示

---

## 3.3 schema.json

定义工具页面 UI，包括上传区域、按钮、参数输入等。

```json
{
  "upload": {
    "multiple": true,
    "types": ["pdf"]
  },
  "options": [],
  "submitText": {
    "en": "Merge PDF",
    "zh": "合并 PDF"
  }
}
```

导航页将根据此结构自动渲染 UI（无需你写前端代码）。

---

## 3.4 handler.js（工具核心逻辑）

后端 Express/Fastify 会自动挂载 API：

```
/api/pdf/merge-pdf
```

示例：

```js
module.exports = async (req, res) => {
  const files = req.files.files;
  const outputPath = await mergePDF(files);
  res.sendFile(outputPath);
};
```

你只需要把工具处理逻辑写在这里。

---

# 4. 工具部署流程（正式流程）

以下流程确保你每个工具能正确接入前端+后端。

---

## ✔ 第 1 步：创建插件目录

```bash
cd /var/www/project
mkdir -p plugins/merge-pdf
```

---

## ✔ 第 2 步：上传四个文件

```bash
scp plugin.json root@server:/var/www/project/plugins/merge-pdf/
scp ui.json root@server:/var/www/project/plugins/merge-pdf/
scp schema.json root@server:/var/www/project/plugins/merge-pdf/
scp handler.js root@server:/var/www/project/plugins/merge-pdf/
```

---

## ✔ 第 3 步：重启后端（非常重要）

```bash
pm2 restart backend
```

后台日志应出现：

```
Loaded plugin: merge-pdf
Mounted route: /api/pdf/merge-pdf
```

如果没看到这个日志 → 文件路径不对或格式错误。

---

## ✔ 第 4 步：测试工具页面自动渲染

浏览器访问：

```
https://yourdomain.com/en/pdf-tools/merge-pdf
```

如果正常显示：

* 工具标题、描述
* 上传组件
* 按钮
* FAQ

说明部署成功。

---

# 5. 自动渲染流程（系统自动完成）

你无需写任何前端，本系统会：

### 1. 根据 slug 生成工具页面

```
/[lang]/pdf-tools/{slug}
```

### 2. 根据 ui.json 渲染：

* H1
* SEO title
* description
* FAQ

### 3. 根据 schema.json 渲染：

* 上传区域
* 参数选项
* Submit 按钮

### 4. 根据 handler.js 处理文件并返回结果

所有逻辑自动运转。

---

# 6. 工具页面报错的常见原因（重点）

如果你的工具无法显示，一定是下面四个原因之一：

| 问题        | 原因                           |
| --------- | ---------------------------- |
| 工具页 404   | plugin.json 的 slug 写错        |
| 工具页内容不显示  | schema.json 格式不正确            |
| SEO 不显示   | ui.json 缺少 title/description |
| 点击按钮报错    | handler.js 路径或返回文件错误         |
| API 不加载   | 后端未重启、文件名大小写错误               |
| 分类页无法显示工具 | plugin.json 中 category 填错    |

我可以帮你排查。

---

# 7. 推荐的插件目录命名规范

使用短横线：

```
merge-pdf
split-pdf
compress-image
resize-image
```

保持 slug 和目录一致可以避免路径错误。

---

# 8. 在已有导航页中添加多个工具

每新增一个工具，只需：

```
/plugins/{tool}/
```

不需要改导航页
不需要改前端
不需要改后端
不需要重新部署前端

---

# 9. 验收标准（工具页面）

部署成功时：

* 分类页 /pdf-tools 自动出现工具卡片
* 工具页自动形成 URL
* SEO 自动渲染
* 上传组件正常
* 后端 handler 可正常处理
* 返回文件下载

你只需要写：
**plugin.json + ui.json + schema.json + handler.js**

前端和路由全部自动。
